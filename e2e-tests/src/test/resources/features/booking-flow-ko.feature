# language: ko
기능: 콘서트 예매 E2E 플로우
  대기열부터 결제까지 전체 예매 흐름을 검증한다

  배경:
    Given 콘서트 서비스가 정상 작동중이다
    And 큐 서비스가 정상 작동중이다
    And 테스트 데이터가 준비되어있다

  시나리오: 정상 예매 플로우
    Given 사용자 "17669445080001234"가 콘서트 "1"에 대기열 진입을 요청한다
    When 대기열 진입 요청을 보낸다
    Then 대기열 진입이 성공한다
    And 대기 순번을 받는다

    When 대기열 상태를 폴링한다
    Then 2분 이내에 "READY" 상태가 된다
    And 큐 토큰을 받는다

    When 스케줄 "1"의 좌석을 조회한다
    Then 좌석 조회가 성공한다
    And 예약 가능한 좌석이 존재한다

    When 첫번째 예약 가능 좌석을 선택한다
    And 좌석 예약을 요청한다
    Then 좌석 예약이 성공한다
    And 예약 ID를 받는다

    When 예약에 대해 결제를 요청한다
    Then 결제가 성공한다
    And 결제 ID를 받는다

    When Kafka 이벤트 처리를 대기한다
    Then 10초 이내에 대기열에서 자동 제거된다
