# Phase 1: ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ìš©ëŸ‰ í•œê³„ ë¶„ì„

**ì‘ì„±ì¼**: 2025-12-26 12:20 KST
**í…ŒìŠ¤íŠ¸ ëª©ì **: VU ë° Redis í’€ ì¦ê°€ê°€ ì„±ëŠ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ë¶„ì„
**ê²°ê³¼**: ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ìµœëŒ€ ì²˜ë¦¬ ìš©ëŸ‰ í™•ì •

---

## ğŸ“‹ Executive Summary

VUë¥¼ 3000 â†’ 5000ìœ¼ë¡œ, Redis í’€ì„ 20 â†’ 50ìœ¼ë¡œ ì¦ê°€ì‹œì¼œ ì„±ëŠ¥ ê°œì„ ì„ ì‹œë„í–ˆìœ¼ë‚˜, **ì˜¤íˆë ¤ ì„±ëŠ¥ì´ ì•…í™”**ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‹œìŠ¤í…œì´ ì´ë¯¸ **ìš©ëŸ‰ í•œê³„(Capacity Limit)**ì— ë„ë‹¬í–ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

**í•µì‹¬ ë°œê²¬**:
- ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ìµœëŒ€ TPS: **~4,300**
- ìµœì  ì„¤ì •: **VU=3000, Redis Pool=20**
- VU ì¦ê°€ ì‹œ ë¦¬ì†ŒìŠ¤ ê²½ìŸ(Contention)ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜
- **ë‹¤ìŒ ë‹¨ê³„**: ìˆ˜í‰ í™•ì¥(Scale-Out) í•„ìš”

---

## 1ï¸âƒ£ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1.1 ê°€ì„¤

**"VUì™€ Redis í’€ì„ ì¦ê°€ì‹œí‚¤ë©´ TPS 5000ì„ ë‹¬ì„±í•  ìˆ˜ ìˆë‹¤"**

**ê·¼ê±°**:
- ì´ì „ í…ŒìŠ¤íŠ¸ì—ì„œ Dropped Iterations 7,114ê°œ ë°œìƒ (VU ë¶€ì¡±)
- Redis ì»¤ë„¥ì…˜ í’€ì´ ë³‘ëª©ì¼ ê°€ëŠ¥ì„±
- ê³µì‹: `maxVUs >= rate Ã— p99_duration`
  - 5000 TPS Ã— 0.65s = 3,250 VUs í•„ìš”
  - ì—¬ìœ  20% í¬í•¨ â†’ **3,900 VUs** ê¶Œì¥

### 1.2 ë³€ê²½ ì‚¬í•­

| í•­ëª© | ì´ì „ (Baseline) | ë³€ê²½ í›„ (Test) | ì¦ê°€ìœ¨ |
|------|----------------|----------------|--------|
| **k6 maxVUs** | 3,000 | 5,000 | +67% |
| **k6 preAllocatedVUs** | 2,000 | 3,000 | +50% |
| **Redis pool max-active** | 20 | 50 | +150% |
| **Redis pool max-idle** | 20 | 50 | +150% |
| **Redis pool min-idle** | 5 | 10 | +100% |

### 1.3 ì˜ˆìƒ ê²°ê³¼

- âœ… Dropped Iterations ê°ì†Œ (7,114 â†’ ~0)
- âœ… ì‹¤ì œ TPS ì¦ê°€ (4,320 â†’ ~5,000)
- âœ… P95/P99 ì‘ë‹µì‹œê°„ ê°œì„  (Redis ëŒ€ê¸° ì‹œê°„ ê°ì†Œ)
- âœ… ì„±ê³µë¥  ìœ ì§€ ë˜ëŠ” í–¥ìƒ (>96%)

---

## 2ï¸âƒ£ ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼

### 2.1 K6 í´ë¼ì´ì–¸íŠ¸ ë©”íŠ¸ë¦­

| ì§€í‘œ | Baseline (VU 3000) | Test (VU 5000) | ë³€í™” | ëª©í‘œ | ë‹¬ì„± |
|------|--------------------|----------------|------|------|------|
| **ì´ ìš”ì²­ ìˆ˜** | 302,889 | **295,035** | **-2.6%** âŒ | 310,000 | 95.2% |
| **ì„±ê³µë¥ ** | 96.49% | **85.57%** | **-11%** âŒ | >95% | âŒ |
| **ì‹¤ì œ TPS** | 4,320 | **4,175** | **-3.4%** âŒ | 5,000 | 83.5% |
| **P50 ì‘ë‹µì‹œê°„** | 1.79ms | **2.92ms** | +63% | - | - |
| **P90 ì‘ë‹µì‹œê°„** | 8.04ms | **806ms** | **+10,000%** âŒ | - | - |
| **P95 ì‘ë‹µì‹œê°„** | 419ms | **1.1s** | **+163%** âŒ | <200ms | âŒ |
| **P99 ì‘ë‹µì‹œê°„** | 651ms | **1.67s** | **+157%** âŒ | <500ms | âŒ |
| **ìµœëŒ€ ì‘ë‹µì‹œê°„** | 1.22s | **2.39s** | +96% | - | - |
| **HTTP ì—ëŸ¬ìœ¨** | 0.00% | **0.04%** | +âˆ | <5% | âœ… |
| **Dropped Iterations** | 7,114 (2.3%) | **14,962 (5.1%)** | **+111%** âŒ | <5% | âŒ |
| **í‰ê·  Iteration Duration** | 115ms | **272ms** | **+136%** âŒ | - | - |

### 2.2 Prometheus ì„œë²„ ë©”íŠ¸ë¦­

| ë©”íŠ¸ë¦­ | Baseline | Test | ìƒíƒœ |
|--------|----------|------|------|
| `queue.wait.size` | 0 | NaN | âš ï¸ ì¸¡ì • ì‹¤íŒ¨ |
| `queue.active.size` | 4 | 0 | âœ… ì •ìƒ |
| **ìŠ¤ì¼€ì¤„ëŸ¬ ì²˜ë¦¬ëŸ‰** | ~40,000 users | **~49,000 users** | âœ… +22% |

**ìŠ¤ì¼€ì¤„ëŸ¬ ë¡œê·¸**:
```log
[PERF] MoveToActive: movedUsers=33,128
[PERF] MoveToActive: movedUsers=15,535
Total: 48,663 users (Baseline: 39,809 users, +22%)
```

### 2.3 ê²°ê³¼ ìš”ì•½

**ì˜ˆìƒê³¼ ë°˜ëŒ€ë¡œ ëª¨ë“  ì„±ëŠ¥ ì§€í‘œê°€ ì•…í™”ë¨**:
- âŒ TPS ê°ì†Œ (4,320 â†’ 4,175, -3.4%)
- âŒ ì„±ê³µë¥  11% í•˜ë½ (96.49% â†’ 85.57%)
- âŒ P95 ì‘ë‹µì‹œê°„ 2.6ë°° ì¦ê°€ (419ms â†’ 1.1s)
- âŒ P99 ì‘ë‹µì‹œê°„ 2.6ë°° ì¦ê°€ (651ms â†’ 1.67s)
- âŒ Dropped Iterations 2ë°° ì¦ê°€ (7,114 â†’ 14,962)
- âœ… ìŠ¤ì¼€ì¤„ëŸ¬ ì²˜ë¦¬ëŸ‰ë§Œ 22% ì¦ê°€

---

## 3ï¸âƒ£ ì›ì¸ ë¶„ì„

### 3.1 ì‹œìŠ¤í…œ í¬í™” ìƒíƒœ (Capacity Saturation)

**í˜„ìƒ**:
- VUë¥¼ 67% ì¦ê°€ì‹œì¼°ì§€ë§Œ TPSëŠ” ì˜¤íˆë ¤ ê°ì†Œ
- ì‘ë‹µì‹œê°„ì´ ê·¹ì ìœ¼ë¡œ ì¦ê°€ (P90: 8ms â†’ 806ms, +10,000%!)
- ë” ë§ì€ VUê°€ ë” ë§ì€ ëŒ€ê¸° ì‹œê°„ì„ ì´ˆë˜

**ì˜ë¯¸**:
ì‹œìŠ¤í…œì´ ì´ë¯¸ **ìµœëŒ€ ì²˜ë¦¬ ìš©ëŸ‰**ì— ë„ë‹¬í–ˆìœ¼ë©°, ì¶”ê°€ ë¶€í•˜ëŠ” ì˜¤íˆë ¤ ì„±ëŠ¥ì„ ì €í•˜ì‹œí‚´.

### 3.2 ë¦¬ì†ŒìŠ¤ ê²½ìŸ (Contention)

**ë©”ì»¤ë‹ˆì¦˜**:
```
ë” ë§ì€ VU â†’ ë” ë§ì€ ë™ì‹œ ìš”ì²­
â†’ ì œí•œëœ ë¦¬ì†ŒìŠ¤(CPU, ë©”ëª¨ë¦¬, Redis) ê²½ìŸ ì‹¬í™”
â†’ ê° ìš”ì²­ì˜ ëŒ€ê¸° ì‹œê°„ ì¦ê°€
â†’ ì „ì²´ ì‘ë‹µì‹œê°„ ì¦ê°€
â†’ ì„±ê³µë¥  ê°ì†Œ (íƒ€ì„ì•„ì›ƒ)
```

**ì¦ê±°**:
- P90 ì‘ë‹µì‹œê°„ í­ì¦: 8ms â†’ 806ms (100ë°°!)
- í‰ê·  Iteration Duration 2.4ë°° ì¦ê°€: 115ms â†’ 272ms
- Dropped Iterations 2ë°° ì¦ê°€: ëŒ€ê¸° ì‹œê°„ì´ ë„ˆë¬´ ê¸¸ì–´ VUê°€ ìƒˆ ë°˜ë³µ ì‹œì‘ ëª»í•¨

### 3.3 ë³‘ëª© ì§€ì  (Bottleneck) ì‹ë³„

**VUì™€ Redis í’€ì´ ë³‘ëª©ì´ ì•„ë‹˜**:
- VU ì¦ê°€ ì‹œ TPSê°€ ì¦ê°€í•˜ì§€ ì•ŠìŒ â†’ **VUëŠ” ì¶©ë¶„í•¨**
- Redis í’€ ì¦ê°€ ì‹œ ì„±ëŠ¥ ê°œì„  ì—†ìŒ â†’ **Redis í’€ì€ ì¶©ë¶„í•¨**

**ì‹¤ì œ ë³‘ëª© ì§€ì **:

#### 1. **CPU ì²˜ë¦¬ ëŠ¥ë ¥**
```
ëŒ€ê¸°ì—´ ì§„ì… ë¡œì§:
1. Wait Queueì— ZADD (O(log N))
2. Wait Queue í¬ê¸° ì¡°íšŒ ZCOUNT (O(log N))
3. ëŒ€ê¸°ì—´ ìœ„ì¹˜ ê³„ì‚° ZRANK (O(log N))
4. ì˜ˆìƒ ëŒ€ê¸° ì‹œê°„ ê³„ì‚° (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
5. JSON ì§ë ¬í™”
```

30ë§Œ ëª… ê·œëª¨ì—ì„œ ê° ìš”ì²­ë§ˆë‹¤ `O(log N)` ì—°ì‚° 3íšŒ ìˆ˜í–‰
â†’ CPU ì§‘ì•½ì 

#### 2. **Redis ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ì²˜ë¦¬ í•œê³„**
- RedisëŠ” **ë‹¨ì¼ ìŠ¤ë ˆë“œ** (Single-threaded)
- ëª¨ë“  ëª…ë ¹ì–´ê°€ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬ë¨
- TPS 4,000~5,000ì´ ë‹¨ì¼ Redis ì¸ìŠ¤í„´ìŠ¤ì˜ ì¼ë°˜ì ì¸ í•œê³„

**Redis ë²¤ì¹˜ë§ˆí¬**:
```bash
# ì¼ë°˜ì ì¸ Redis ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ì„±ëŠ¥
# Simple GET/SET: ~100,000 TPS
# Sorted Set (ZADD, ZRANK): ~10,000 TPS
# ë³µì¡í•œ Lua ìŠ¤í¬ë¦½íŠ¸: ~5,000 TPS
```

ìš°ë¦¬ ì‹œìŠ¤í…œì€ ë³µì¡í•œ ì—°ì‚° (ZADD + ZCOUNT + ZRANK) ìˆ˜í–‰
â†’ **~4,300 TPSê°€ í˜„ì‹¤ì ì¸ í•œê³„**

#### 3. **ë„¤íŠ¸ì›Œí¬ I/O**
- ê° ìš”ì²­ë§ˆë‹¤ Redis ì™•ë³µ 3íšŒ (ZADD, ZCOUNT, ZRANK)
- ì‘ë‹µ í˜ì´ë¡œë“œ ì§ë ¬í™”/ì—­ì§ë ¬í™”
- ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ ë° ë ˆì´í„´ì‹œ ì˜í–¥

### 3.4 Little's Law ê²€ì¦

**Little's Law**: `ë™ì‹œ ì‚¬ìš©ì ìˆ˜ = TPS Ã— í‰ê·  ì‘ë‹µì‹œê°„`

**Baseline (VU 3000)**:
```
ì‹¤ì œ TPS: 4,320
í‰ê·  ì‘ë‹µì‹œê°„: 14ms (http_req_duration avg)
í•„ìš” VU: 4,320 Ã— 0.014 = 60 VUs

ì‹¤ì œ ì‚¬ìš© VU: ~2,143 (í‰ê· )
â†’ VUê°€ ì¶©ë¶„íˆ ë§ìŒ (60 << 2,143)
```

**Test (VU 5000)**:
```
ì‹¤ì œ TPS: 4,175
í‰ê·  ì‘ë‹µì‹œê°„: 167ms (http_req_duration avg)
í•„ìš” VU: 4,175 Ã— 0.167 = 697 VUs

ì‹¤ì œ ì‚¬ìš© VU: ~5,000 (í‰ê· )
â†’ VUê°€ ê³¼ë„í•˜ê²Œ ë§ìŒ (697 << 5,000)
â†’ ëŒ€ë¶€ë¶„ì˜ VUê°€ ëŒ€ê¸° ì¤‘ (Idle)
â†’ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ ë° ê²½ìŸ ì¦ê°€
```

**ê²°ë¡ **: VU ì¦ê°€ëŠ” ë¶ˆí•„ìš”í•˜ë©° ì˜¤íˆë ¤ í•´ë¡œì›€

---

## 4ï¸âƒ£ ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ìµœì  ì„¤ì • í™•ì •

### 4.1 ìµœì  ì„±ëŠ¥ ì„¤ì •

| í•­ëª© | ìµœì ê°’ | ê·¼ê±° |
|------|--------|------|
| **k6 maxVUs** | **3,000** | Little's Law ê¸°ì¤€ í•„ìš” VUì˜ 4ë°° ì—¬ìœ  |
| **k6 preAllocatedVUs** | **2,000** | ë©”ëª¨ë¦¬ íš¨ìœ¨ |
| **Redis pool max-active** | **20** | ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì¶©ë¶„ |
| **Redis pool max-idle** | **20** | max-activeì™€ ë™ì¼ |
| **Redis pool min-idle** | **5** | ìµœì†Œ ì»¤ë„¥ì…˜ ìœ ì§€ |

### 4.2 ë‹¬ì„± ì„±ëŠ¥ ì§€í‘œ

| ì§€í‘œ | ê°’ | ëª©í‘œ ëŒ€ë¹„ |
|------|-------|-----------|
| **ì‹¤ì œ TPS** | **4,320** | 86.4% (ëª©í‘œ: 5,000) |
| **ì„±ê³µë¥ ** | **96.49%** | âœ… ë‹¬ì„± (ëª©í‘œ: >95%) |
| **P95 ì‘ë‹µì‹œê°„** | **419ms** | âŒ ë¯¸ë‹¬ (ëª©í‘œ: <200ms) |
| **P99 ì‘ë‹µì‹œê°„** | **651ms** | âŒ ë¯¸ë‹¬ (ëª©í‘œ: <500ms) |
| **ì´ ì²˜ë¦¬ ìš”ì²­** | **302,889** | 97.7% (ëª©í‘œ: 310,000) |
| **Dropped Iterations** | **7,114 (2.3%)** | âš ï¸ ê°œì„  í•„ìš” |

### 4.3 ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ìš©ëŸ‰ í•œê³„

**í™•ì •ëœ ìµœëŒ€ ì²˜ë¦¬ ìš©ëŸ‰**:
```
Max TPS: ~4,300
Max Concurrent Users: ~300,000 (ëŒ€ê¸°ì—´)
Active Queue Processing: ~40,000 users/test
Scheduler Throughput: ~5,000 users/5s
```

---

## 5ï¸âƒ£ ì„±ëŠ¥ ê°œì„ ì„ ìœ„í•œ ë‹¤ìŒ ë‹¨ê³„

### 5.1 ìˆ˜í‰ í™•ì¥ (Scale-Out) âœ… ê¶Œì¥

**ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ í•œê³„ ëŒíŒŒëŠ” ìˆ˜í‰ í™•ì¥ìœ¼ë¡œë§Œ ê°€ëŠ¥**

#### Option A: Queue Service 2ê°œ ì¸ìŠ¤í„´ìŠ¤

**ì˜ˆìƒ íš¨ê³¼**:
- TPS: 4,300 Ã— 2 = **~8,600** (ëª©í‘œ 5,000 ë‹¬ì„± âœ…)
- ì„±ê³µë¥ : >95% ìœ ì§€
- ì‘ë‹µì‹œê°„: ë¶€í•˜ ë¶„ì‚°ìœ¼ë¡œ P95/P99 ê°œì„  ê°€ëŠ¥

**êµ¬í˜„ ë°©ë²•**:
```bash
# docker-compose.simple-scale.yml ì‚¬ìš©
docker-compose -f docker-compose.simple-scale.yml up -d --scale queue-service=2

# ë¡œë“œ ë°¸ëŸ°ì„œ í•„ìš” (Nginx/HAProxy)
```

**í•„ìš” ì‘ì—…**:
1. âœ… ë¶„ì‚° ìŠ¤ì¼€ì¤„ëŸ¬ ë½ í™œì„±í™”
   ```yaml
   scheduler:
     lock:
       strategy: cluster  # none â†’ cluster
   ```
2. âœ… ë¡œë“œ ë°¸ëŸ°ì„œ ì„¤ì •
3. âœ… ì¸ìŠ¤í„´ìŠ¤ë³„ ë©”íŠ¸ë¦­ íƒœê·¸ êµ¬ë¶„

#### Option B: Queue Service 4ê°œ ì¸ìŠ¤í„´ìŠ¤

**ì˜ˆìƒ íš¨ê³¼**:
- TPS: 4,300 Ã— 4 = **~17,200**
- ë” ë†’ì€ ì—¬ìœ  ìš©ëŸ‰ (Headroom)
- ì¥ì•  ë³µì›ë ¥ í–¥ìƒ

### 5.2 ìˆ˜ì§ í™•ì¥ (Scale-Up) âš ï¸ ì œí•œì  íš¨ê³¼

**CPU/ë©”ëª¨ë¦¬ ì¦ê°€ëŠ” ì œí•œì  íš¨ê³¼**:
- Redisê°€ ë‹¨ì¼ ìŠ¤ë ˆë“œ â†’ CPU ì½”ì–´ ì¦ê°€ëŠ” íš¨ê³¼ ì—†ìŒ
- ì• í”Œë¦¬ì¼€ì´ì…˜ë„ ì¶©ë¶„í•œ CPU ì‚¬ìš© ì¤‘
- ë¹„ìš© ëŒ€ë¹„ íš¨ê³¼ ë‚®ìŒ

**ê¶Œì¥í•˜ì§€ ì•ŠìŒ**

### 5.3 ì• í”Œë¦¬ì¼€ì´ì…˜ ìµœì í™” âš ï¸ í•œê³„ì  íš¨ê³¼

**ê°€ëŠ¥í•œ ìµœì í™”**:
1. ëŒ€ê¸°ì—´ ìœ„ì¹˜ ê³„ì‚° ìºì‹± (TTL 1ì´ˆ)
   - ì˜ˆìƒ íš¨ê³¼: P95/P99 20% ê°œì„ 
   - ë³µì¡ë„: Medium

2. Redis Pipeline ì‚¬ìš©
   - ZADD + ZCOUNT + ZRANK í•œ ë²ˆì— ì „ì†¡
   - ì˜ˆìƒ íš¨ê³¼: ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ê°ì†Œ, 5~10% TPS ê°œì„ 
   - ë³µì¡ë„: Low

3. Wait Queue í¬ê¸° ì¡°íšŒ ë¹ˆë„ ê°ì†Œ
   - ì˜ˆìƒ íš¨ê³¼: ë¯¸ë¯¸ (ZCOUNTëŠ” ë¹ ë¦„)
   - ë³µì¡ë„: Low

**ì´ ì˜ˆìƒ íš¨ê³¼**: TPS 10~15% ê°œì„  (4,300 â†’ ~4,800)
**ëª©í‘œ 5,000 TPS ë‹¬ì„± ë¶ˆê°€ëŠ¥**

---

## 6ï¸âƒ£ Lessons Learned

### 6.1 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ êµí›ˆ

**1. "ë” ë§ì€ ë¦¬ì†ŒìŠ¤ â‰  ë” ì¢‹ì€ ì„±ëŠ¥"**
- VUë¥¼ 67% ì¦ê°€ì‹œì¼°ì§€ë§Œ ì„±ëŠ¥ì€ ì•…í™”ë¨
- ì‹œìŠ¤í…œ ìš©ëŸ‰ í•œê³„ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”
- ê³¼ë„í•œ ë¦¬ì†ŒìŠ¤ëŠ” ê²½ìŸ(Contention)ì„ ì¼ìœ¼í‚´

**2. Little's Lawë¡œ í•„ìš” VU ê³„ì‚°**
```
í•„ìš” VU = TPS Ã— í‰ê·  ì‘ë‹µì‹œê°„

Baseline: 4,320 Ã— 0.014 = 60 VUs
â†’ ì‹¤ì œ ì‚¬ìš©: 2,143 VUs (36ë°° ê³¼ì‰)
```

**3. ë³‘ëª© ì§€ì ì„ ì •í™•íˆ ì‹ë³„í•´ì•¼ í•¨**
- VUê°€ ë¶€ì¡±í•œ ê²ƒì²˜ëŸ¼ ë³´ì˜€ì§€ë§Œ (Dropped Iterations)
- ì‹¤ì œë¡œëŠ” ì‹œìŠ¤í…œ ìš©ëŸ‰ í•œê³„ (CPU, Redis)
- ë©”íŠ¸ë¦­ì„ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•´ì•¼ í•¨

### 6.2 ì‹œìŠ¤í…œ ì„¤ê³„ êµí›ˆ

**1. ë‹¨ì¼ Redis ì¸ìŠ¤í„´ìŠ¤ì˜ í•œê³„**
- TPS 4,000~5,000ì´ í˜„ì‹¤ì  í•œê³„
- ë³µì¡í•œ ì—°ì‚° (Sorted Set, Lua Script)ì€ ë” ë‚®ìŒ
- ë†’ì€ ì²˜ë¦¬ëŸ‰ í•„ìš” ì‹œ Redis Cluster í•„ìˆ˜

**2. ìˆ˜í‰ í™•ì¥ ì„¤ê³„ì˜ ì¤‘ìš”ì„±**
- ì´ˆê¸°ë¶€í„° ë¶„ì‚° í™˜ê²½ì„ ê³ ë ¤í•œ ì„¤ê³„
- ë¶„ì‚° ë½ (Scheduler Lock) ë¯¸ë¦¬ êµ¬í˜„
- ë¬´ìƒíƒœ(Stateless) ì„œë²„ ì„¤ê³„

**3. ì„±ëŠ¥ ëª©í‘œ ì„¤ì • ì‹œ í˜„ì‹¤ì„± ê³ ë ¤**
- TPS 5,000 ëª©í‘œëŠ” ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ë¡œ ê³¼ë„í•¨
- ì´ˆê¸°ë¶€í„° ìˆ˜í‰ í™•ì¥ì„ ì—¼ë‘ì— ë‘¬ì•¼ í•¨
- ë‹¨ê³„ì  ëª©í‘œ (Phase 1: 5K, Phase 2: 10K, Phase 3: 20K)

### 6.3 í…ŒìŠ¤íŠ¸ ë°©ë²•ë¡  êµí›ˆ

**1. Baseline ë¨¼ì € í™•ë¦½**
- ìµœì  ì„¤ì •ì„ ì°¾ê¸° ìœ„í•´ ì—¬ëŸ¬ ì¡°ê±´ í…ŒìŠ¤íŠ¸
- Baseline ëŒ€ë¹„ ë³€í™” ì¸¡ì •
- ì„±ëŠ¥ ì €í•˜ ì‹œ ì¦‰ì‹œ ë¡¤ë°±

**2. ë©”íŠ¸ë¦­ ë‹¤ê°ë„ ë¶„ì„**
- í´ë¼ì´ì–¸íŠ¸ (k6) + ì„œë²„ (Prometheus) + ë¡œê·¸
- í•œ ê°€ì§€ ë©”íŠ¸ë¦­ë§Œ ë³´ë©´ ì˜¤íŒ ê°€ëŠ¥
- ì˜ˆ: Dropped Iterationsë§Œ ë³´ë©´ VU ë¶€ì¡±ìœ¼ë¡œ ì˜¤í•´

**3. ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹œ ëª¨ë‹ˆí„°ë§**
- CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬ I/O ì‹¤ì‹œê°„ í™•ì¸
- ì–´ëŠ ë¦¬ì†ŒìŠ¤ê°€ ë¨¼ì € í¬í™”ë˜ëŠ”ì§€ íŒŒì•…
- ë³‘ëª© ì§€ì  ì‹ë³„

---

## 7ï¸âƒ£ ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­

### 7.1 Phase 1 ìµœì¢… ê²°ê³¼

**ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ìµœì  ì„±ëŠ¥**:
- âœ… TPS: 4,320 (ëª©í‘œ 5,000ì˜ 86.4%)
- âœ… ì„±ê³µë¥ : 96.49% (ëª©í‘œ >95% ë‹¬ì„±)
- âš ï¸ P95/P99: 419ms/651ms (ëª©í‘œ ë¯¸ë‹¬)
- âš ï¸ ì´ ì²˜ë¦¬: 302,889 (ëª©í‘œ 310,000ì˜ 97.7%)

**ìš©ëŸ‰ í•œê³„ í™•ì •**:
- ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ë¡œëŠ” **TPS 5,000 ë‹¬ì„± ë¶ˆê°€ëŠ¥**
- Redis ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ í•œê³„: ~4,300 TPS
- VU ë° Redis í’€ ì¦ê°€ëŠ” **ì—­íš¨ê³¼**

### 7.2 ì¦‰ì‹œ ì ìš© ì‚¬í•­

**1. ì„¤ì • ë¡¤ë°± (ì™„ë£Œ)**
```yaml
# k6-tests/queue-entry-scale-test.js
maxVUs: 3000          # 5000 â†’ 3000
preAllocatedVUs: 2000 # 3000 â†’ 2000

# queue-service/src/main/resources/application.yml
max-active: 20  # 50 â†’ 20
max-idle: 20    # 50 â†’ 20
min-idle: 5     # 10 â†’ 5
```

**2. Baseline ë¬¸ì„œí™” (ì™„ë£Œ)**
- ìµœì  ì„¤ì • ê¸°ë¡
- ì„±ëŠ¥ ì§€í‘œ í™•ì •
- ë³‘ëª© ì§€ì  ëª…ì‹œ

### 7.3 ë‹¤ìŒ ë‹¨ê³„ (Phase 2)

**ìš°ì„ ìˆœìœ„ 1: ìˆ˜í‰ í™•ì¥ í…ŒìŠ¤íŠ¸**

| ë‹¨ê³„ | ì‘ì—… | ì˜ˆìƒ ì†Œìš” | ëª©í‘œ |
|------|------|-----------|------|
| **1** | ë¶„ì‚° ìŠ¤ì¼€ì¤„ëŸ¬ ë½ í™œì„±í™” | 30ë¶„ | ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ |
| **2** | Nginx ë¡œë“œ ë°¸ëŸ°ì„œ ì„¤ì • | 1ì‹œê°„ | íŠ¸ë˜í”½ ë¶„ì‚° |
| **3** | 2ê°œ ì¸ìŠ¤í„´ìŠ¤ ë°°í¬ ë° í…ŒìŠ¤íŠ¸ | 1ì‹œê°„ | TPS 8,600 ë‹¬ì„± |
| **4** | 4ê°œ ì¸ìŠ¤í„´ìŠ¤ í…ŒìŠ¤íŠ¸ | 30ë¶„ | TPS 17,200 ë‹¬ì„± |
| **5** | ê²°ê³¼ ë¶„ì„ ë° ë¬¸ì„œí™” | 1ì‹œê°„ | Phase 2 ì™„ë£Œ |

**ì´ ì˜ˆìƒ ì‹œê°„**: 4ì‹œê°„

**ìš°ì„ ìˆœìœ„ 2: ì• í”Œë¦¬ì¼€ì´ì…˜ ìµœì í™”**
- ëŒ€ê¸°ì—´ ìœ„ì¹˜ ê³„ì‚° ìºì‹±
- Redis Pipeline ì ìš©
- ì˜ˆìƒ íš¨ê³¼: TPS 10~15% ê°œì„  (ë¶€ì°¨ì )

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ
- [Performance Improvement Plan](./performance-improvement-plan.md)
- [Troubleshooting: Phase 1 Scheduler Failure](./troubleshooting-phase1-scheduler-failure.md)

### í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì›ë³¸
- **Baseline Test**: 2025-12-26 12:00 KST (VU 3000, Pool 20)
- **Capacity Test**: 2025-12-26 12:18 KST (VU 5000, Pool 50)

### ì™¸ë¶€ ì°¸ì¡°
- [Little's Law](https://en.wikipedia.org/wiki/Little%27s_law)
- [Redis Performance Tuning](https://redis.io/docs/management/optimization/)
- [K6 Load Testing Best Practices](https://k6.io/docs/testing-guides/running-large-tests/)

---

**ë¬¸ì„œ ì‘ì„± ì™„ë£Œ**: 2025-12-26 12:30 KST
**ê²°ë¡ **: ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ìµœì  ì„¤ì • í™•ì •, Phase 2 ìˆ˜í‰ í™•ì¥ ì¤€ë¹„ ì™„ë£Œ
