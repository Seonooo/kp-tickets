# Performance Comparison: DB Pool 50 vs 150

**테스트 일시**:
- Baseline (Pool 50): 2025-12-30 18:05
- After (Pool 150): 2025-12-30 18:20

**공통 환경**:
- ZGC 적용
- k6 E2E Test (83초, ~1200 VUs)
- Heap: 2GB

---

## 🎯 핵심 목표 달성 여부

### Before (Pool 50)
```
❌ Booking Success Rate: 88.65% (목표: >95%)
✅ Activation Wait Time: p(95)=3864.5ms (목표: <120s)
✅ E2E Total Duration: p(95)=29266ms (목표: <180s)
```

### After (Pool 150)
```
✅ Booking Success Rate: 95.62% (목표: >95%) ⭐ 달성!
✅ Activation Wait Time: p(95)=4713.5ms (목표: <120s)
✅ E2E Total Duration: p(95)=25676ms (목표: <180s)
```

**결과**: 주요 비즈니스 목표 달성! 🎉

---

## 📊 성능 비교표

### 1. 안정성 지표

| 지표 | Pool 50 | Pool 150 | 개선율 | 평가 |
|------|---------|----------|--------|------|
| Check Success | 97.39% | **99.01%** | +1.62%p | ⭐⭐⭐ |
| HTTP Failed Rate | 2.33% | **0.88%** | **-62%** | ⭐⭐⭐ |
| Seats Failures | 128 (4.1%) | **0 (0%)** | **-100%** | ⭐⭐⭐ |
| Reservation Failures | 210 (6.9%) | **141 (4.4%)** | -33% | ⭐⭐ |
| Payment Failures | 20 (0.7%) | **0 (0%)** | **-100%** | ⭐⭐⭐ |
| **Booking Success** | **88.65%** | **95.62%** | **+6.97%p** | ⭐⭐⭐ |

### 2. 처리량 지표

| 지표 | Pool 50 | Pool 150 | 개선율 |
|------|---------|----------|--------|
| TPS | 182.7 req/s | **194.5 req/s** | +6.5% |
| Total Requests | 15,318 | **15,973** | +4.3% |
| Completed Iterations | 3,156 | **3,222** | +2.1% |
| Dropped Iterations | 3,749 | 3,789 | -1% ⚠️ |
| Drop Rate | 54% | 54% | 0% |

### 3. E2E Duration

| 지표 | Pool 50 | Pool 150 | 개선율 |
|------|---------|----------|--------|
| Average | 16.43s | **14.52s** | **-11.6%** ⭐ |
| Median | 14.95s | **13.74s** | -8.1% |
| P90 | 25.84s | **22.69s** | -12.2% ⭐ |
| P95 | 29.27s | **25.68s** | **-12.3%** ⭐ |
| P99 | 34.61s | **29.56s** | -14.6% ⭐ |
| Max | 48.30s | **40.38s** | -16.4% ⭐ |

### 4. Booking Duration

| 지표 | Pool 50 | Pool 150 | 개선율 |
|------|---------|----------|--------|
| Average | 14.30s | **12.00s** | **-16.1%** ⭐⭐ |
| P95 | 27.75s | **23.06s** | **-16.9%** ⭐⭐ |

### 5. API 응답 시간 (P95)

| API | 목표 | Pool 50 | Pool 150 | 개선율 | 목표 달성 |
|-----|------|---------|----------|--------|-----------|
| **Seats Query** | <500ms | 6.04s | **4.55s** | **-24.7%** ⭐⭐ | ❌ (9배 초과) |
| **Reservation** | <1000ms | 3.46s | **2.97s** | **-14.2%** ⭐ | ❌ (3배 초과) |
| **Payment** | <2000ms | 3.92s | **3.33s** | **-15.1%** ⭐ | ❌ (1.7배 초과) |
| Queue Entry | <200ms | 1.71s | 2.85s | -66.7% ❌ | ❌ (14배 초과) |
| Poll | <100ms | 1.85s | 2.7s | -45.9% ❌ | ❌ (27배 초과) |

### 6. Overall HTTP Duration (P95)

| 지표 | Pool 50 | Pool 150 | 개선율 |
|------|---------|----------|--------|
| P95 | 3.61s | **3.44s** | -4.7% |
| Average | 1.28s | **796ms** | **-37.8%** ⭐⭐⭐ |
| Median | 933ms | **260ms** | **-72.1%** ⭐⭐⭐ |

---

## 🎯 상세 분석

### ✅ 성공 요인

#### 1. DB Connection Pool 병목 부분 해소
- **증상**: Pool 50에서 Seats Query 6.04s → Pool 150에서 4.55s (-25%)
- **원인**: 150 connections로 DB 대기 시간 감소
- **효과**:
  - Seats 실패율 4.1% → 0% (완전 해소)
  - Payment 실패율 0.7% → 0% (완전 해소)
  - Reservation 실패율 6.9% → 4.4% (33% 감소)

#### 2. 전체 안정성 향상
- HTTP 실패율 62% 감소 (2.33% → 0.88%)
- Check 성공률 99% 달성
- **Booking Success Rate 95.62% 달성!** ⭐

#### 3. E2E 성능 개선
- E2E Duration P95: 29.3s → 25.7s (-12.3%)
- Booking Duration avg: 14.3s → 12.0s (-16.1%)
- 사용자 체감 성능 향상

### ⚠️ 여전한 과제

#### 1. API 응답 시간 목표 미달
- **Seats Query**: 4.55s (목표: <500ms, 9배 초과)
- **Reservation**: 2.97s (목표: <1s, 3배 초과)
- **Payment**: 3.33s (목표: <2s, 1.7배 초과)

**원인 추정**:
- DB 쿼리 최적화 필요 (인덱스, N+1 문제 등)
- Application 로직 최적화 필요
- 동시성 처리 개선 필요

#### 2. Queue Entry/Poll 성능 악화
- Queue Entry: 1.71s → 2.85s (-67%)
- Poll: 1.85s → 2.7s (-46%)

**원인 추정**:
- 전체 처리량 증가로 Queue Service 부하 증가
- Redis 경합 증가 가능성
- Queue Scheduler 성능 한계

#### 3. 높은 Drop Rate 유지
- Drop Rate: 54% 유지
- 테스트가 시스템 한계를 테스트하도록 설계됨
- 실제 프로덕션 부하는 이보다 낮을 것으로 예상

---

## 💡 결론 및 권장사항

### ✅ 달성한 것
1. **핵심 목표 달성**: Booking Success Rate 95.62% (>95%)
2. **안정성 대폭 개선**: 실패율 62% 감소, Seats/Payment 100% 성공
3. **DB 병목 부분 해소**: Connection Pool 증가로 DB 대기 시간 감소
4. **처리량 증가**: 182.7 → 194.5 req/s (+6.5%)

### ⏳ 추가 최적화 기회

#### 우선순위 1: DB 쿼리 최적화
- **Seats Query** 최적화 (현재 4.55s → 목표 <500ms)
  - 인덱스 확인 및 추가
  - 쿼리 플랜 분석
  - N+1 문제 확인

#### 우선순위 2: Application 로직 최적화
- **Reservation** 최적화 (현재 2.97s → 목표 <1s)
- **Payment** 최적화 (현재 3.33s → 목표 <2s)
- 불필요한 동기 처리 제거
- 병렬 처리 도입

#### 우선순위 3: Queue Service 최적화
- Redis 경합 최소화
- Queue Scheduler 성능 개선
- Polling 전략 개선

### 🎉 종합 평가

**Pool 50 → Pool 150 전환은 성공적!**

- ✅ 주요 비즈니스 목표 달성 (Booking Success >95%)
- ✅ 시스템 안정성 크게 향상
- ✅ DB Connection Pool 병목 부분 해소
- ⏳ 추가 최적화로 목표 latency 달성 가능

**권장**:
- 현재 설정(Pool 150 + ZGC) 유지
- DB 쿼리 및 Application 로직 최적화 진행
- 점진적 개선 접근
