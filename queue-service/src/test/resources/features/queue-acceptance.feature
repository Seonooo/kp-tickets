# language: ko
@acceptance
기능: 콘서트 대기열 시스템
  콘서트 예매를 원하는 사용자는 대기열에 등록하고
  자신의 차례가 되면 예매 페이지에 입장할 수 있다

  배경:
    Given 새로운 사용자가 콘서트 예매를 시도한다

  # ==========================================
  # 대기열 진입
  # ==========================================

  @enter
  시나리오: 사용자가 콘서트 대기열에 등록한다
    When 대기열에 등록을 요청한다
    Then 대기열 등록이 완료된다
    And 나의 대기 순번을 확인할 수 있다

  @enter @concurrent
  시나리오: 많은 사용자가 동시에 대기열에 등록해도 순번이 정상 발급된다
    When 50명의 사용자가 동시에 대기열 등록을 요청한다
    Then 모든 사용자의 등록이 완료된다
    And 각 사용자는 서로 다른 순번을 받는다

  # ==========================================
  # 대기 상태 확인
  # ==========================================

  @status
  시나리오: 대기 중인 사용자가 현재 상태를 확인한다
    Given 대기열에 등록한 상태이다
    When 나의 대기 상태를 확인한다
    Then 현재 대기 중임을 알 수 있다
    And 나의 대기 순번을 확인할 수 있다

  @status @ready
  시나리오: 입장 차례가 된 사용자가 알림을 받는다
    Given 대기열에 등록한 상태이다
    And 나의 입장 차례가 되었다
    When 나의 대기 상태를 확인한다
    Then 입장 가능 상태임을 확인할 수 있다
    And 입장 토큰을 받는다
    And 토큰 만료 시간을 확인할 수 있다

  # ==========================================
  # 예매 페이지 입장
  # ==========================================

  @activate
  시나리오: 입장 가능한 사용자가 예매 페이지에 들어간다
    Given 대기열에 등록한 상태이다
    And 나의 입장 차례가 되었다
    When 예매 페이지에 입장한다
    Then 예매 페이지 입장이 완료된다
    And 예매를 진행할 수 있는 토큰을 받는다

  # ==========================================
  # 시간 연장
  # ==========================================

  @extend
  시나리오: 예매 중인 사용자가 시간 연장을 요청한다
    Given 대기열에 등록한 상태이다
    And 나의 입장 차례가 되었다
    And 예매 페이지에 입장한 상태이다
    When 시간 연장을 요청한다
    Then 시간 연장이 완료된다
    And 연장 횟수가 1회로 기록된다

  @extend
  시나리오: 예매 중인 사용자가 2번째 시간 연장을 요청한다
    Given 대기열에 등록한 상태이다
    And 나의 입장 차례가 되었다
    And 예매 페이지에 입장한 상태이다
    And 이미 1회 시간을 연장한 상태이다
    When 시간 연장을 요청한다
    Then 시간 연장이 완료된다
    And 연장 횟수가 2회로 기록된다

  # ==========================================
  # 토큰 유효성 검증
  # ==========================================

  @validate
  시나리오: 예매 진행 중인 사용자의 토큰이 유효한지 확인한다
    Given 대기열에 등록한 상태이다
    And 나의 입장 차례가 되었다
    And 예매 페이지에 입장한 상태이다
    When 토큰 유효성을 확인한다
    Then 유효한 토큰임이 확인된다

  @validate
  시나리오: 입장 가능한 사용자의 토큰이 유효한지 확인한다
    Given 대기열에 등록한 상태이다
    And 나의 입장 차례가 되었다
    When 토큰 유효성을 확인한다
    Then 유효한 토큰임이 확인된다

