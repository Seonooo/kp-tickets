spring:
  application:
    name: queue-service

  data:
    redis:
      host: ${SPRING_REDIS_HOST:localhost}
      port: ${SPRING_REDIS_PORT:6379}
      password: ${SPRING_REDIS_PASSWORD:}
      lettuce:
        pool:
          max-active: ${REDIS_POOL_MAX_ACTIVE:20}  # 대량 트래픽 대비 증가
          max-idle: ${REDIS_POOL_MAX_IDLE:20}
          min-idle: ${REDIS_POOL_MIN_IDLE:5}

  kafka:
    bootstrap-servers: ${SPRING_KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    consumer:
      group-id: ${KAFKA_CONSUMER_GROUP_ID:queue-service-group}
      auto-offset-reset: ${KAFKA_AUTO_OFFSET_RESET:earliest}
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
      acks: ${KAFKA_PRODUCER_ACKS:all}
      retries: ${KAFKA_PRODUCER_RETRIES:3}

server:
  port: ${SERVER_PORT:8081}

# Queue 설정
queue:
  # 대기열 설정
  waiting:
    max-size: ${QUEUE_WAITING_MAX_SIZE:10000}  # 최대 대기 인원

  # 활성 대기열 설정
  active:
    max-size: ${QUEUE_ACTIVE_MAX_SIZE:50000}  # 동시 처리 가능 인원 (대규모 트래픽 대비)
    token-ttl-seconds: ${QUEUE_ACTIVE_TOKEN_TTL:300}  # 토큰 유효시간 (5분)

  # 스케줄러 설정
  scheduler:
    activation-interval-ms: ${QUEUE_ACTIVATION_INTERVAL:5000}  # 활성화 주기 (5초)
    cleanup-interval-ms: ${QUEUE_CLEANUP_INTERVAL:1000}  # 만료 토큰 정리 주기 (1초)

  # 폴링 설정
  polling:
    fast-interval-ms: ${QUEUE_POLLING_FAST_INTERVAL:3000}      # 빠른 폴링 간격 (3초)
    slow-interval-ms: ${QUEUE_POLLING_SLOW_INTERVAL:10000}     # 느린 폴링 간격 (10초)
    fast-threshold: ${QUEUE_POLLING_FAST_THRESHOLD:1000}       # 빠른 폴링 기준 순번
    min-interval-ms: ${QUEUE_POLLING_MIN_INTERVAL:2000}        # 클라이언트 권장 최소 폴링 간격 (2초)
    # Token Bucket Rate Limiting
    rate-limit-capacity: ${QUEUE_POLLING_RATE_LIMIT_CAPACITY:10}    # 버킷 최대 용량 (10개)
    rate-limit-refill-rate: ${QUEUE_POLLING_RATE_LIMIT_REFILL:0.5}  # 초당 리필 토큰 수 (0.5 = 2초당 1개)
    executor-pool-size: ${QUEUE_POLLING_EXECUTOR_POOL_SIZE:10}      # Virtual Thread Executor 풀 크기

# Kafka Topic 설정
kafka:
  topic:
    payment-completed: ${KAFKA_TOPIC_PAYMENT_COMPLETED:booking.payment.completed}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: ${ACTUATOR_HEALTH_SHOW_DETAILS:when_authorized}
      probes:
        enabled: true
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true

logging:
  level:
    root: ${LOG_LEVEL_ROOT:INFO}
    personal.ai.queue: ${LOG_LEVEL_APP:DEBUG}
