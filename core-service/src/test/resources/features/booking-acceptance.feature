# language: ko
@acceptance
기능: 콘서트 좌석 예약 시스템
  콘서트 티켓을 예매하려는 사용자가
  좌석을 조회하고 예약하고 결제하는 과정을 테스트합니다

  배경:
    Given 예약 가능한 콘서트 스케줄이 존재한다

  # ==========================================
  # 좌석 조회
  # ==========================================

  @seats
  시나리오: 사용자가 예약 가능한 좌석을 조회한다
    When 좌석 목록 조회를 요청한다
    Then 좌석 목록이 반환된다
    And 각 좌석의 정보가 포함된다

  # ==========================================
  # 좌석 예약
  # ==========================================

  @reservation
  시나리오: 사용자가 좌석을 예약한다
    Given 예약 가능한 좌석이 있다
    When 해당 좌석 예약을 요청한다
    Then 예약이 생성된다
    And 예약 상태는 대기 중이다
    And 예약 만료 시간이 설정된다

  @reservation @negative
  시나리오: 이미 예약된 좌석은 예약할 수 없다
    Given 이미 예약된 좌석이 있다
    When 해당 좌석 예약을 요청한다
    Then 예약에 실패한다
    And 좌석이 이미 예약되었다는 메시지가 반환된다

  # ==========================================
  # 동시 예약 (동시성 테스트)
  # ==========================================

  @reservation @concurrent
  시나리오: 여러 사용자가 동시에 같은 좌석을 예약 시도한다
    Given 예약 가능한 좌석이 있다
    When 10명의 사용자가 동시에 같은 좌석을 예약 시도한다
    Then 오직 1명의 사용자만 예약에 성공하고
    And 9명의 사용자는 예약에 실패한다

  # ==========================================
  # 예약 조회
  # ==========================================

  @reservation @query
  시나리오: 사용자가 자신의 예약을 조회한다
    Given 예약을 완료한 사용자이다
    When 나의 예약 조회를 요청한다
    Then 예약 정보가 반환된다
    And 예약한 좌석 정보가 포함된다

  # ==========================================
  # 결제
  # ==========================================

  @payment
  시나리오: 사용자가 예약에 대해 결제한다
    Given 대기 중인 예약이 있다
    When 결제를 요청한다
    Then 결제가 완료된다
    And 예약 상태가 확정으로 변경된다

  @payment @negative
  시나리오: 만료된 예약은 결제할 수 없다
    Given 만료된 예약이 있다
    When 결제를 요청한다
    Then 결제에 실패한다
    And 예약이 만료되었다는 메시지가 반환된다
