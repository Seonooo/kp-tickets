spring:
  application:
    name: core-service-test

  # Testcontainers @ServiceConnection이 자동으로 설정
  # Kafka bootstrap-servers는 KafkaContainer가 제공하는 동적 주소 사용
  # main application.yml의 환경변수 기본값을 override

server:
  port: 0  # 랜덤 포트 사용 (테스트 시)

# External Service Mock 설정 (테스트용)
external:
  queue-service:
    base-url: http://localhost:8081
    connect-timeout-ms: 200
    read-timeout-ms: 1000

# Resilience4j 테스트 설정 (빠른 테스트 실행을 위한 조정)
resilience4j:
  circuitbreaker:
    instances:
      queueService:
        slidingWindowType: TIME_BASED
        slidingWindowSize: 5
        minimumNumberOfCalls: 100
        failureRateThreshold: 50
        slowCallDurationThreshold: 1000ms
        slowCallRateThreshold: 50
        waitDurationInOpenState: 5000ms
        permittedNumberOfCallsInHalfOpenState: 10
        registerHealthIndicator: true
        ignoreExceptions:
          - personal.ai.common.exception.BusinessException
  bulkhead:
    instances:
      queueService:
        maxConcurrentCalls: 100
        maxWaitDuration: 0ms
  retry:
    instances:
      queueService:
        maxAttempts: 2
        waitDuration: 200ms

logging:
  level:
    root: INFO
    personal.ai.core: DEBUG
    org.testcontainers: INFO
    org.apache.kafka: WARN
    io.github.resilience4j: DEBUG  # Circuit Breaker 상태 변경 로그
